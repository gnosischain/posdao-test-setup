version: '3.8'
services:
  node:
    image: sigp/lighthouse:v2.2.1-modern
    hostname: node
    command: |
      lighthouse beacon_node
      --testnet-dir /root/sbc/config
      --port 13001
      --eth1-endpoints http://host.docker.internal:8740,http://host.docker.internal:8741,http://host.docker.internal:8742,http://host.docker.internal:8743
      --datadir /home/.eth2/beaconchaindata
      --http-address 0.0.0.0
      --http-port 5051
      --http
      --disable-upnp
      --disable-discovery
      --debug-level debug
      --merge
      --suggested-fee-recipient 0x0feefeefeefeefeefeefeefeefeefeefeefeefee
      --libp2p-addresses /dns/host.docker.internal/tcp/13002/p2p/16Uiu2HAmLCN7qTEBuknCa6R7thyTdUjALjYTpkSsrHhq3FKEL5q9
    ports:
      - '13001:13001'
      - '5051:5051'
    volumes:
      - ./config:/root/sbc/config
      - ./node_db:/home/.eth2/beaconchaindata
    logging:
      driver: "json-file"
      options:
        max-size: "100m"
        max-file: "1"
  node2:
    image: sigp/lighthouse:v2.2.1-modern
    hostname: node2
    command: |
      lighthouse beacon_node
      --testnet-dir /root/sbc/config
      --port 13002
      --eth1-endpoints http://host.docker.internal:8740,http://host.docker.internal:8741,http://host.docker.internal:8742,http://host.docker.internal:8743
      --datadir /home/.eth2/beaconchaindata
      --http-address 0.0.0.0
      --http-port 5052
      --http
      --disable-upnp
      --disable-discovery
      --debug-level debug
      --merge
      --suggested-fee-recipient 0x0feefeefeefeefeefeefeefeefeefeefeefeefee
      --libp2p-addresses /dns/host.docker.internal/tcp/13001/p2p/16Uiu2HAmN5seNB3AYkTo4qRC3oWsPTEGiR68w5suCcuqG3pSf4Ze
    ports:
      - '13002:13002'
      - '5052:5052'
    volumes:
      - ./config2:/root/sbc/config
      - ./node2_db:/home/.eth2/beaconchaindata
    logging:
      driver: "json-file"
      options:
        max-size: "100m"
        max-file: "1"
  validator:
    image: sigp/lighthouse:v2.2.1-modern
    hostname: validator
    depends_on:
      - node
      - node2
    command: |
      lighthouse validator_client
      --testnet-dir /root/sbc/config
      --validators-dir /root/sbc/validators
      --beacon-nodes http://node:5051,http://node2:5052
      --graffiti-file /root/sbc/config/graffiti.yml
    volumes:
      - ./config:/root/sbc/config
      - ./validators:/root/sbc/validators
    logging:
      driver: "json-file"
      options:
        max-size: "100m"
        max-file: "1"
